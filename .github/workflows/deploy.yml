name: Engine3D Package Deployment

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-22.04
    steps:
      - name: ğŸ“¥ Install Conan ${{ inputs.conan_version }}
        run: pip3 install conan
      - name: ğŸ“¡ Add `engnie3d` repo to conan remotes
        run: conan remote add engine3d-dev
          https://libengine3d.jfrog.io/artifactory/api/conan/engine3d-dev-conan
      
      - name: ğŸ“¡ Create and setup default profile
        run: conan profile detect --force

      - name: ğŸ‘ï¸â€ğŸ—¨ï¸ Show conan profile
        run: conan profile show
        
      - name: ğŸ“¡ Install linux default profiles
        run: conan config install -sf profiles/x86_64/linux/ -tf profiles https://github.com/engine3d-dev/conan-config.git

      # - name: ğŸ“¦ Create `Debug` package
        # run: conan create . -s build_type=Debug

      # - name: ğŸ“¦ Create `RelWithDebInfo` package
      #   run: conan create . -s build_type=RelWithDebInfo

      # - name: ğŸ“¦ Create `MinSizeRel` package
      #   run: conan create . -s build_type=MinSizeRel

      # - name: ğŸ“¦ Create `Release` package
      #   run: conan create . -s build_type=Release
      - name: Create Defauly Package
        run: conan create . -b missing
      
      - name: ğŸ“¡ Sign into JFrog Artifactory
        # if: ${{ inputs.version != '' }}
        env:
          PASSWORD: ${{ secrets.JFROG_ENGINE3D_TRUNKEN_ID_TOKEN }}
          JFROG_USER: ${{ secrets.JFROG_USERNAME }}
        run: conan remote login -p $PASSWORD engine3d-dev $JFROG_USER
        
      - name: ğŸ†™ Upload package version ${{ inputs.version }} to `engine3d` repo
        if: ${{ inputs.version != '' }}
        run: conan upload "${{ inputs.library }}/${{ inputs.version }}" --confirm -r=engine3d-dev
